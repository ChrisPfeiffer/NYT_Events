<!DOCTYPE html>
<html>

<head>
  <title>Events in New York</title>    
  <link rel="stylesheet" type="text/css" href="css/events_styles.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
</head>

<body>
    <div id="map"></div>
    <h5 class="text-center">Categories</h5>
    <br/>
    <ul class="checkbox-grid">
      <li><input type="checkbox" name="text1" value="value1" /><label for="text1">Text 1</label></li>
      <li><input type="checkbox" name="text2" value="value2" /><label for="text2">Text 2</label></li>
      <li><input type="checkbox" name="text3" value="value3" /><label for="text3">Text 3</label></li>
      <li><input type="checkbox" name="text4" value="value4" /><label for="text4">Text 4</label></li>
      <li><input type="checkbox" name="text5" value="value5" /><label for="text5">Text 5</label></li>
      <li><input type="checkbox" name="text6" value="value6" /><label for="text6">Text 6</label></li>
    </ul>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.min.js"></script>  
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD5_EfcE8JN5H8FFL1eTYUTahS-jIeYp6U&sensor=true"></script>
  
  <!--create th map opject-->
  <script type="text/javascript">

    $(document).ready(initMap);

  var map;
  var markers = [];

  function initMap() {
    var latlng = new google.maps.LatLng(40.7127,-74.0059);
    var options = {
        zoom: 15,
        center: latlng,
        mapTypeId: google.maps.MapTypeId.ROADMAP
  };

  map = new google.maps.Map(document.getElementById('map'), options);

  var url = "http://events2339.azurewebsites.net/api/events/getevents?parameters=ll=40.7127,-74.0059&radius=5000";
  $.getJSON(url, function (jsonPayload) {
    $.each(jsonPayload, function(i, item){
        var marker = new google.maps.Marker({
        position: {lat: parseFloat(item.geocode_latitude), lng: parseFloat(item.geocode_longitude)},
        map: map,
        title: 'test_title'
      });

      markers.push(marker);

    });
  });

    function setMapOnAll(map) {
      for (var i = 0; i < markers.length; i++) {
        markers[i].setMap(map);
      }
    }

    function clearMarkers() {
       setMapOnAll(null);
    }

    map.addListener('idle', function()
    {
      var bounds = map.getBounds();
      var center = map.getCenter();

      var url = "http://events2339.azurewebsites.net/api/events/getevents?parameters=ll="+center.G+","+center.K+"&radius=5000";

      clearMarkers();
      markers = [];

      $.getJSON(url, function(jsonPayload){
        $.each(jsonPayload, function(i, item){
          var marker = new google.maps.Marker({
          position: {lat: parseFloat(item.geocode_latitude), lng: parseFloat(item.geocode_longitude)},
          map: map,
          title: 'test_title2'
        });
          markers.push(marker);
        });
      });

      console.log(center);
    });

        
};



  
  </script>
</body>
</html>