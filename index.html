<!DOCTYPE html>
<html>

<head>
  <title>Events in New York</title>    
  <style type="text/css">
  html, body { height: 100%; margin: 0; padding: 0; }
  #map { height: 60%; }
  </style>
</head>

<body>
  <div id="map"></div>

  <!-- bring in the backbone libraries-->

  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.min.js"></script>
  <script src="http://ajax.cdnjs.com/ajax/libs/underscore.js/1.1.4/underscore-min.js"></script>
  <script src="http://ajax.cdnjs.com/ajax/libs/backbone.js/0.3.3/backbone-min.js"></script>
  
  <!--initialize the collection by calling the NYT api -->  
  <script>
  (function($){

    alert('script is running');

    var EventModel = Backbone.Model.extend({
      urlRoot: 'http://api.nytimes.com/svc/events/v2/listings.jsonp?ll=40.756146,-73.99021&radius=2500&api-key=1b6ec24de1512db2fae47f5165ce39ea:6:69563513'      
    })

    var EventModels = Backbone.Collection.extend({
      model: EventModel,
      url: 'http://api.nytimes.com/svc/events/v2/listings.jsonp?ll=40.756146,-73.99021&radius=2500&api-key=1b6ec24de1512db2fae47f5165ce39ea:6:69563513',
      
      sync : function(method, collection, options) {

        options.dataType = "jsonp";
        return Backbone.sync(method, collection, options);
      },     
      parse : function(response) {
        return response.data.results;
      }
    });

    var events = new EventModels();

    events.fetch({
      data : {},

      success : function(collection, response, options)
      {
        console.log(collection);
        console.log(response);
        console.log(options);
      },

      error : function(collection, response, options) {
      console.log(response.statusText);
      },
  // A timeout is the only way to get an error event for JSONP calls!
    timeout : 5000

    });

  })(jQuery);
  </script>

  <!--create th map opject-->
  <script type="text/javascript">
  var map;
  function initMap() {
    map = new google.maps.Map(document.getElementById('map'), {
      center: {lat: 40.7127, lng: -74.0059},
      zoom: 8
    });
  }
  </script>
  <script async defer
  src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD5_EfcE8JN5H8FFL1eTYUTahS-jIeYp6U&callback=initMap">
  </script>
</body>
</html>